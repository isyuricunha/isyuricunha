name: "Auto Release"

on:
  push:
    branches:
      - "master"

jobs:
  auto-release:
    name: "Automatic Release"
    runs-on: "ubuntu-latest"
    steps:
      - name: "Checkout repository"
        uses: actions/checkout@v2

      - name: "Build & test"
        run: |
          # Your build and test commands here
          echo "Build and test completed successfully!"
        
      - name: "Set up Git"
        run: |
          git config user.name "${GITHUB_ACTOR}"
          git config user.email "${GITHUB_ACTOR}@users.noreply.github.com"

      - name: "Get latest tag"
        id: get_tag
        run: |
          latest_tag=$(git describe --tags --abbrev=0)
          echo "::set-output name=latest_tag::$latest_tag"

      - name: "Generate new tag"
        id: generate_tag
        run: |
          latest_tag=$1
          IFS='.' read -r -a version_parts <<< "$latest_tag"
          major=${version_parts[0]}
          minor=${version_parts[1]}
          patch=${version_parts[2]}
          new_patch=$((patch + 1))
          new_tag="$major.$minor.$new_patch"
          echo "::set-output name=new_tag::$new_tag"

      - name: "Create tag"
        id: create_tag
        run: |
          new_tag=$1
          git tag $new_tag
          git push origin $new_tag
        env:
          NEW_TAG: ${{ steps.generate_tag.outputs.new_tag }}
